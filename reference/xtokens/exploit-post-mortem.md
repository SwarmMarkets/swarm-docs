# Exploit post-mortem

{% hint style="warning" %}
This write-up is based on the assumption that the MEV Bot (0xa19e4fec1624c87fe0dd307103ffc5923ce89bef) is a white-hat actor - the post-mortem will be published on Medium after the return of the secured funds to the reserve wallet at 0x857cc51F07924B82e931B473131c965415d070f6
{% endhint %}

### Summary

On January 25, 2024, Swarm Markets platform suffered a security breach that resulted in a vulnerability in several of the wrapping smart contracts on Ethereum, including SMT, WETH, USDC and DAI.

Two actors were identified as being involved in the incident.&#x20;

The hacker attempted to pull assets from the affected wrapping smart contracts (xTokens).

Several attempts by the hacker were successfully intercepted by a white-hat friendly MEV bot (white-hat hacker), who secured the majority of withdrawal attempts. The hacker was left with a total of 472,891.80 SMT, 7826.70 DAI and 3234.50 USDC (approx. $120K in value).

The root cause of the issue goes back to 2022, when Swarm was working with an outside vendor to develop a pilot version of the platform. During migration from the pilot platform to a new version, the developers from the vendor laid out a procedure to transfer the administration of all components to the Swarm team while removing any addresses affiliated with the vendor.&#x20;

The documentation omitted the change of one role that, today, allowed the attacker to remap the xToken contracts within the platform and subsequently draw crypto from the wrapping contracts.&#x20;

It is unclear at this point, whether this omission was done maliciously or not, or whether the exploit was done by a person(s) currently affiliated with the vendor or not. This will be further investigated.

Action was taken by the Swarm team immediately as soon as the hack was discovered to prevent any further damages. We will continue to investigate thoroughly.

### Chronology

Some times are estimated.

January 25, 2024

* **05:31:47 AM +UTC** - The attacker initiates the attack by transferring the Proxy Admin [ownership from to Hacker Address 1](https://etherscan.io/tx/0x2b8e2a60a453d1903f9f5b1903c00a20cef3f3e94cb399252a1803a1826f6cab) (0x959E2CC532115d0a86e24EB2977D93Df6202560E)
* **05:32:47 AM +UTC** - The Proxy Admin was [used to change the implementation](https://etherscan.io/tx/0x3b380824408ae6d4945f8fac310c3d4fe09ad1be16f8601b60f2ff7306418032) of the [Action Manager](https://etherscan.io/address/0x9835fa9b914bcbc45d731edde0d1d63adb56c477) to a [\`Caller\` contract](https://etherscan.io/address/0xbeaee712741c7f99b64b798ca127fe776d491fb4); the \`Caller\` contract consisted of a simple function allowing caller to \`registerToken\` in the xTokenWrapper, changing the mapping of native tokens to xTokens
* **05:11:11 AM +UTC** - ‘Caller’ contract re-mapped native tokens (SMT, WETH, USDC, DAI) to two fake xTokens created by the hacker, which are freely mintable ([Fake xToken1](https://etherscan.io/address/0xd08e245fdb3f1504aea4056e2c71615da7001440))
* **05:15:59 AM +UTC** - The hacker address minted fake xTokens ([Tx1](https://etherscan.io/tx/0x1f53d0ad45c39a1bfabdadd543195e7a09ed65d1a1113f7575dba1232a8560ba), [Tx2](https://etherscan.io/tx/0xb40151fea6d8bf23944fbbf74355f1edb30383fe36eda678c371496457fa4e8c), [Tx3](https://etherscan.io/tx/0x591bd56dfedf5eb489928074ec00796314f0b48be3cc407ec8158de1fbb59928), [Tx4](https://etherscan.io/tx/0x134805d5ae859be48f08844d193c328d93b2e16f0eb8f571aef47c5c9ec2b40b))
* **05:38:59 AM +UTC** - While the hacker starts to use fake xTokens to unwrap native tokens, the friendly white-hat Hacker identifies the irregularities and secures funds into their wallet, [starting with 168 WETH](https://etherscan.io/tx/0xe0a609029f9e88915da37e585ee3cd84d0346c0323bdaf1be19bec47549a72cb)  &#x20;
* **06:07:59 AM +UTC** - The hacker starts to use fake xTokens to unwrap native tokens to Hacker Address 1, starting with 427k SMT ([Tx1](https://etherscan.io/tx/0x80fe95da4d2578f4cfb170d4b9e94feb3826dd2a9e483552f255d1fc41e41e94), [Tx2](https://etherscan.io/tx/0x08a42636d69a7b20d15153f85f1361185ade8895e67f32dd980b4121872fc3fb), [Tx3](https://etherscan.io/tx/0x80fe95da4d2578f4cfb170d4b9e94feb3826dd2a9e483552f255d1fc41e41e94), [Tx4](https://etherscan.io/tx/0x439787d035f45f100521c19333c6a7db91230edd67228b4e145d7456d223c18d), [Tx5](https://etherscan.io/tx/0x34d4e7758d14a8337eb606107df3a039ad07007fac7040f0e61270b5bedd5f2e), [Tx6](https://etherscan.io/tx/0xd477a049fbddbe0e847c960749a77d0e267baed25a02f034edb659b69108bdb6), [Tx7](https://etherscan.io/tx/0xcacbbd0eea986cc01b0170d332d6459d0d513c0b3c19e169e70da3f5e135ef6d)) followed by a [transfer of 427k SMT](https://etherscan.io/tx/0x6c4786035533105178655de71fac7c279f709e315ca1cc666ab9b5add9e11900) from Hacker Address 1 to Address 2 (0x27c317181b3dbf8ca8c3771e47cf7e7fad812512)
* **06:08:47 AM +UTC** - At this point the white-hat hacker secures a total of 4,255,905 SMT into [their wallet](https://etherscan.io/address/0xa9686d9b68f484c0dd08f48076bdfaf5914bd319#tokentxns) using the minting of 200 xTokens and multicall transactions for unwrapping.&#x20;
* **06:18:23 AM +UTC** - At this point the hacker, redeploys another fake xToken contact ([Fake xToken2](https://etherscan.io/address/0x0a3fbf5b4cf80db51fcae21efe63f6a36d45d2b2))
* **06:22:47 AM +UTC** - The hacker choses to [swap](https://etherscan.io/tx/0xe6e026e7a39e1548f5ae36424deb3580347337b0d59e66af1ab3925d63906fb5) the already pulled 427k SMT into 54 WETH &#x20;
* **08:03:23 AM +UTC** - The hacker then pulls a total of 7,826.7 DAI and 3,234.5 USDC using the fake xTokens from the second contact, which still remain there.

### Moving forward

The Swarm Markets team has taken the following actions:

* reviewed security procedures and safeguarded current platform on Ethereum and Polygon
* the platform on Polygon, any part of the new platform version or those that dealt with RWA trading, have not been affected by this exploit
* the platform on Ethereum will remain suspended until further thorough investigation is concluded
* we responded to an outreach by the white-hat hacker to establish communications to recover funds
* hacker wallets (0x959E2CC532115d0a86e24EB2977D93Df6202560E, 0x27c317181b3dbf8ca8c3771e47cf7e7fad812512) have been reported to different chain analytics companies and other friendly CEX’s
* communications with stakeholders and users affected done via e-mail, Telegram and Twitter; communication was provided continuously after discovery
* further investigation into the potential involvement of the vendor will be initiated.

We are impressed and encouraged with the positive and supporting sentiment that our community has responded with during this time.

We’d like to extend a huge thank-you to MEV BOT White hats (0xa19E4Fec1624c87fE0DD307103Ffc5923cE89BeF) involved in the recovery of the funds. We are very grateful.

Thank you,\
**The Swarm Team**\
